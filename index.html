<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä»Šæ—¥ã¯ã©ã“ã«é£Ÿã¹ã«è¡Œã“ã†ï¼Ÿï½œé‹å‘½ã®ãƒ©ãƒ³ãƒæ±ºå®šæ©Ÿ</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä»Šæ—¥ã¯ã©ã“ã«é£Ÿã¹ã«è¡Œã“ã†ï¼Ÿï½œé‹å‘½ã®ãƒ©ãƒ³ãƒæ±ºå®šæ©Ÿ</title>

    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ™</text></svg>"
    />

    <meta property="og:title" content="ä»Šæ—¥ã¯ã©ã“ã«é£Ÿã¹ã«è¡Œã“ã†ï¼Ÿ" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="ã€å…¬é–‹å¾Œã«ç™ºè¡Œã•ã‚Œã‚‹URLã‚’ã“ã“ã«å…¥ã‚Œã¾ã™ã€‘"
    />
    <meta
      property="og:image"
      content="ã€ã‚¢ãƒ—ãƒªã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç”»åƒã®URLï¼ˆã‚ã‚Œã°ï¼‰ã€‘"
    />
    <meta
      property="og:description"
      content="ç¾åœ¨åœ°å‘¨è¾ºã®ãŠåº—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§é¸ã‚“ã§ãã‚Œã‚‹å„ªæŸ”ä¸æ–­ãªäººã®ãŸã‚ã®ã‚¢ãƒ—ãƒªã§ã™ã€‚"
    />
    <meta name="twitter:card" content="summary" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Zen+Maru+Gothic:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4869770734682452"
     crossorigin="anonymous"></script>
ã€€ã€€<meta name="google-site-verification" content="PMNbiqRRvyNg5xDd92y6Uw9gKxENMv1S2agnyT-RbkM" />
    <style>
      :root {
        --primary: #ff6b6b; /* é£Ÿæ¬²ã®èµ¤ */
        --secondary: #feca57; /* å…ƒæ°—ã®é»„è‰² */
        --bg: #f7f1e3; /* å„ªã—ã„ã‚¯ãƒªãƒ¼ãƒ è‰² */
        --text: #2d3436;
        --shadow: rgba(0, 0, 0, 0.15);
      }

      body {
        font-family: "Zen Maru Gothic", sans-serif;
        background-color: var(--bg);
        color: var(--text);
        text-align: center;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        font-family: "Mochiy Pop One", sans-serif;
        color: var(--primary);
        font-size: 1.5rem; /* ç´„24px */
        text-shadow: 2px 2px 0px #fff;
        margin-bottom: 10px;
      }

      /* ç”»é¢å¹…ãŒ600pxä»¥ä¸Šï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»PCï¼‰ã«ãªã£ãŸã‚‰ä¸Šæ›¸ã */
      @media (min-width: 600px) {
        h1 {
          font-size: 3rem; /* ç´„48px */
        }
      }

      .container {
        max-width: 500px;
        width: 100%;
        background: white;
        border-radius: 20px;
        padding: 30px 20px;
        box-shadow: 0 10px 25px var(--shadow);
        margin-bottom: 20px;
      }

      /* ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
      #roulette-box {
        background: #fff;
        border: 4px solid var(--text);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        min-height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }

      #result-name {
        font-family: "Mochiy Pop One", sans-serif;
        font-size: 1.8rem;
        line-height: 1.4;
        color: var(--text);
        z-index: 2;
      }

      #result-meta {
        font-size: 0.9rem;
        color: #666;
        margin-top: 10px;
      }

      /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
      .btn-main {
        font-family: "Mochiy Pop One", sans-serif;
        background: var(--primary);
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 1.2rem;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 6px 0 #c0392b; /* ç«‹ä½“çš„ãªå½± */
        transition: all 0.1s;
        width: 80%;
        max-width: 300px;
      }

      .btn-main:active {
        box-shadow: 0 0 0 #c0392b;
        transform: translateY(6px); /* æŠ¼ã—ãŸæ™‚ã«æ²ˆã‚€ */
      }

      .btn-main:disabled {
        background: #ccc;
        box-shadow: none;
        cursor: not-allowed;
      }

      /* çµæœãŒå‡ºãŸå¾Œã®ãƒœã‚¿ãƒ³é¡ */
      .action-area {
        display: none; /* æœ€åˆã¯éš ã™ */
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }

      .btn-sub {
        padding: 10px 20px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: bold;
        display: inline-block;
        font-size: 0.9rem;
        transition: transform 0.2s;
        border: none;
        cursor: pointer;
      }

      .btn-map {
        background: #4285f4;
        color: white;
        box-shadow: 0 4px 0 #2a56c6;
      }
      .btn-share {
        background: #000;
        color: white;
        box-shadow: 0 4px 0 #333;
      }

      .btn-sub:active {
        transform: translateY(4px);
        box-shadow: none;
      }

      .btn-sub:hover {
        opacity: 0.9;
      }

      /* è£…é£¾çš„ãªèƒŒæ™¯ãƒ‘ã‚¿ãƒ¼ãƒ³ */
      .bg-pattern {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(
          var(--secondary) 2px,
          transparent 2px
        );
        background-size: 20px 20px;
        opacity: 0.3;
        z-index: -1;
      }

      /* è©•ä¾¡ã®æ˜Ÿ */
      .rating {
        color: #f1c40f;
        font-size: 1.2rem;
      }

      /* åœ°å›³ã¯éš ã—ã¦ãŠã */
      #map {
        height: 0;
        opacity: 0;
      }
      /* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
      .toggle-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px; /* ãƒœã‚¿ãƒ³ã¨ã®é–“éš” */
      }

      /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹è‡ªä½“ã¯éš ã™ */
      #open-now-toggle {
        display: none;
      }

      /* ã‚¹ã‚¤ãƒƒãƒã®èƒŒæ™¯ */
      .toggle-button {
        position: relative;
        width: 50px;
        height: 26px;
        background-color: #ccc; /* OFFã®ã¨ãã®è‰² */
        border-radius: 13px;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      /* ã‚¹ã‚¤ãƒƒãƒã®ä¸¸ã„éƒ¨åˆ† */
      .toggle-button::after {
        content: "";
        position: absolute;
        top: 3px;
        left: 3px;
        width: 20px;
        height: 20px;
        background-color: white;
        border-radius: 50%;
        transition: 0.3s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* ONã«ãªã£ãŸã¨ãã®å¤‰åŒ– */
      #open-now-toggle:checked + .toggle-button {
        background-color: var(--primary); /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ï¼ˆèµ¤ï¼‰ */
      }

      #open-now-toggle:checked + .toggle-button::after {
        transform: translateX(24px); /* ä¸¸ã‚’å³ã«ç§»å‹• */
      }

      .toggle-text {
        font-weight: bold;
        color: var(--text);
      }

      /* è¨­å®šã‚¨ãƒªã‚¢ */
      .settings-area {
        margin: 20px 0;
        text-align: left;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .setting-row {
        margin-bottom: 15px;
      }

      .setting-row:last-child {
        margin-bottom: 0;
      }

      .setting-label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
        color: var(--text);
        font-size: 0.9rem;
      }

      /* ãƒ¬ãƒ³ã‚¸ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
      .range-slider {
        width: 100%;
        -webkit-appearance: none;
        height: 8px;
        border-radius: 5px;
        background: #ddd;
        outline: none;
        margin-bottom: 5px;
      }

      .range-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary);
        cursor: pointer;
      }

      .range-slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary);
        cursor: pointer;
        border: none;
      }

      .range-value {
        font-size: 0.85rem;
        color: #666;
      }

      /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ */
      select {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 2px solid #ddd;
        font-family: inherit;
        font-size: 1rem;
        background: white;
        cursor: pointer;
      }

      /* å±¥æ­´ã‚¨ãƒªã‚¢ */
      .history-section {
        margin-top: 20px;
        padding: 15px;
        background: #fff3cd;
        border-radius: 10px;
        text-align: left;
      }

      .history-title {
        font-weight: bold;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .history-list {
        max-height: 200px;
        overflow-y: auto;
      }

      .history-item {
        padding: 8px;
        background: white;
        margin-bottom: 5px;
        border-radius: 5px;
        font-size: 0.85rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .clear-history {
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
        font-size: 0.8rem;
        text-decoration: underline;
      }

      .btn-retry {
        background: var(--secondary);
        color: var(--text);
        box-shadow: 0 4px 0 #d4a017;
      }

      .history-empty {
        color: #999;
        font-size: 0.85rem;
        text-align: center;
        padding: 10px;
      }
      /* ãƒ•ãƒƒã‚¿ãƒ¼å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      footer {
        width: 100%;
        margin-top: auto; /* ã“ã‚ŒãŒé‡è¦ï¼šè‡ªå‹•ã§ä¸€ç•ªä¸‹ã¾ã§æŠ¼ã—ä¸‹ã’ã‚‹ */
        background-color: #eee;
        color: #666;
        padding: 20px 0;
        font-size: 0.8rem;
      }

      .footer-content {
        max-width: 500px;
        margin: 0 auto;
        padding: 0 20px;
        text-align: center;
      }

      /* ãƒªãƒ³ã‚¯ã®è‰² */
      footer a {
        color: var(--primary); /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã«åˆã‚ã›ã‚‹ */
        text-decoration: none;
        font-weight: bold;
        cursor: pointer;
      }

      .footer-links {
        margin: 10px 0;
      }

      .copyright {
        color: #999;
        font-size: 0.7rem;
        margin-top: 10px;
      }
    </style>
  </head>

  <body>
    <div class="bg-pattern"></div>

    <h1>ä»Šæ—¥ã¯ã©ã“ã«é£Ÿã¹ã«è¡Œã“ã†ï¼Ÿ</h1>
    <p>è¿·ã£ãŸã‚‰é‹ã«ä»»ã›ã‚ˆã†ï¼<br />ç¾åœ¨åœ°å‘¨è¾ºã®ã‚°ãƒ«ãƒ¡ã‚’æŠ½é¸ã—ã¾ã™ã€‚</p>

    <div class="container">
      <div id="roulette-box">
        <div id="result-name">ï¼Ÿï¼Ÿï¼Ÿ</div>
        <div id="result-meta">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼</div>
      </div>

      <!-- è¨­å®šã‚¨ãƒªã‚¢ -->
      <div class="settings-area">
        <div class="setting-row">
          <label class="setting-label">æ¤œç´¢ç¯„å›²</label>
          <input
            type="range"
            id="radius-slider"
            class="range-slider"
            min="500"
            max="3000"
            step="500"
            value="1000"
            oninput="updateRadiusValue()"
          />
          <div class="range-value">
            ç¾åœ¨: <span id="radius-value">1000</span>m
          </div>
        </div>

        <div class="setting-row">
          <label class="setting-label" for="genre-select"
            >ã‚¸ãƒ£ãƒ³ãƒ« (ã–ã£ãã‚Š)</label
          >
          <select id="genre-select">
            <option value="">ã™ã¹ã¦</option>
            <option value="å’Œé£Ÿ">å’Œé£Ÿ</option>
            <option value="æ´‹é£Ÿ">æ´‹é£Ÿ</option>
            <option value="ä¸­è¯">ä¸­è¯æ–™ç†</option>
            <option value="ã‚¤ã‚¿ãƒªã‚¢ãƒ³">ã‚¤ã‚¿ãƒªã‚¢ãƒ³</option>
            <option value="ãƒ•ãƒ¬ãƒ³ãƒ">ãƒ•ãƒ¬ãƒ³ãƒ</option>
            <option value="ã‚«ãƒ•ã‚§">ã‚«ãƒ•ã‚§</option>
            <option value="ãƒ©ãƒ¼ãƒ¡ãƒ³">ãƒ©ãƒ¼ãƒ¡ãƒ³</option>
            <option value="ç„¼è‚‰">ç„¼è‚‰</option>
            <option value="å¯¿å¸">å¯¿å¸</option>
            <option value="å±…é…’å±‹">å±…é…’å±‹</option>
          </select>
        </div>

        <div class="setting-row">
          <div class="toggle-wrapper">
            <input type="checkbox" id="open-now-toggle" checked />
            <label for="open-now-toggle" class="toggle-button"></label>
            <span class="toggle-text">å–¶æ¥­ä¸­ã®ãŠåº—ã®ã¿</span>
          </div>
        </div>
      </div>

      <button id="start-btn" class="btn-main" onclick="startRoulette()">
        ãŠåº—ã‚’æ±ºã‚ã‚‹ï¼
      </button>

      <div id="action-area" class="action-area">
        <a id="map-link" href="#" target="_blank" class="btn-sub btn-map"
          >ğŸ“ Googleãƒãƒƒãƒ—ã§è¡Œã</a
        >
        <a id="share-link" href="#" target="_blank" class="btn-sub btn-share"
          >ğ• çµæœã‚’ã‚·ã‚§ã‚¢</a
        >
      </div>

      <!-- å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="history-section">
        <div class="history-title">
          <span>ğŸ“œ å±¥æ­´</span>
          <button class="clear-history" onclick="clearHistory()">ã‚¯ãƒªã‚¢</button>
        </div>
        <div id="history-list" class="history-list">
          <div class="history-empty">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
        </div>
      </div>
    </div>

    <div id="map"></div>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD38YvZGary_bXCCIK6htsCJ1L1TjjEQz4&libraries=places&callback=initMap"
      async
      defer
    ></script>

    <script>
      let map;
      let service;
      const resultName = document.getElementById("result-name");
      const resultMeta = document.getElementById("result-meta");
      const actionArea = document.getElementById("action-area");
      const startBtn = document.getElementById("start-btn");
      let currentResults = []; // ç¾åœ¨ã®æ¤œç´¢çµæœã‚’ä¿æŒ
      let excludedPlaceIds = []; // é™¤å¤–ã™ã‚‹ãŠåº—ã®ID
      let currentPlace = null; // ç¾åœ¨è¡¨ç¤ºä¸­ã®ãŠåº—

      // å±¥æ­´ç®¡ç†
      function loadHistory() {
        const history = localStorage.getItem("restaurantHistory");
        return history ? JSON.parse(history) : [];
      }

      function saveToHistory(place) {
        let history = loadHistory();
        const historyItem = {
          name: place.name,
          vicinity: place.vicinity,
          placeId: place.place_id,
          timestamp: new Date().toISOString(),
        };

        // åŒã˜ãŠåº—ãŒæ—¢ã«å±¥æ­´ã«ã‚ã‚‹å ´åˆã¯å‰Šé™¤ï¼ˆæœ€æ–°ã‚’ä¸Šã«ï¼‰
        history = history.filter((item) => item.placeId !== place.place_id);
        history.unshift(historyItem);

        // æœ€å¤§10ä»¶ã¾ã§ä¿å­˜
        if (history.length > 10) {
          history = history.slice(0, 10);
        }

        localStorage.setItem("restaurantHistory", JSON.stringify(history));
        displayHistory();
      }

      function displayHistory() {
        const history = loadHistory();
        const historyList = document.getElementById("history-list");

        if (history.length === 0) {
          historyList.innerHTML =
            '<div class="history-empty">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
          return;
        }

        historyList.innerHTML = history
          .map((item) => {
            const date = new Date(item.timestamp);
            const dateStr = `${
              date.getMonth() + 1
            }/${date.getDate()} ${date.getHours()}:${String(
              date.getMinutes()
            ).padStart(2, "0")}`;
            return `
            <div class="history-item">
              <div>
                <strong>${item.name}</strong><br>
                <small style="color: #666;">${item.vicinity}</small>
              </div>
              <small style="color: #999;">${dateStr}</small>
            </div>
          `;
          })
          .join("");
      }

      function clearHistory() {
        if (confirm("å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
          localStorage.removeItem("restaurantHistory");
          displayHistory();
        }
      }

      function updateRadiusValue() {
        const slider = document.getElementById("radius-slider");
        document.getElementById("radius-value").innerText = slider.value;
      }

      function retryWithExclusion() {
        if (currentPlace) {
          excludedPlaceIds.push(currentPlace.place_id);
          console.log("é™¤å¤–ãƒªã‚¹ãƒˆ:", excludedPlaceIds);
        }

        if (currentResults.length > excludedPlaceIds.length) {
          const availableResults = currentResults.filter(
            (place) => !excludedPlaceIds.includes(place.place_id)
          );

          if (availableResults.length > 0) {
            runAnimation(availableResults);
          } else {
            alert("ä»–ã«å€™è£œãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ¡ä»¶ã‚’å¤‰ãˆã¦å†æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚");
          }
        } else {
          alert("ä»–ã«å€™è£œãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ¡ä»¶ã‚’å¤‰ãˆã¦å†æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚");
        }
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å±¥æ­´ã‚’è¡¨ç¤º
      window.addEventListener("DOMContentLoaded", () => {
        displayHistory();
      });

      function initMap() {
        const center = new google.maps.LatLng(35.6895, 139.6917);
        map = new google.maps.Map(document.getElementById("map"), {
          center: center,
          zoom: 15,
        });
        service = new google.maps.places.PlacesService(map);
        console.log("Google Maps API initialized successfully");
      }

      function startRoulette() {
        // Google Maps APIãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
        if (!map || !service) {
          handleError(
            "Google Maps APIã®èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚<br>å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"
          );
          setTimeout(() => {
            startBtn.disabled = false;
          }, 2000);
          return;
        }

        // UIã®ãƒªã‚»ãƒƒãƒˆ
        startBtn.disabled = true;
        actionArea.style.display = "none";
        resultName.innerText = "æ¤œç´¢ä¸­...";
        resultMeta.innerText = "ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™";
        excludedPlaceIds = []; // é™¤å¤–ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };
              searchNearbyRestaurants(pos);
            },
            () => {
              handleError(
                "ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
              );
            }
          );
        } else {
          handleError("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
        }
      }

      function searchNearbyRestaurants(location) {
        resultName.innerText = "ãŠåº—ã‚’æ¢ã—ã¦ã„ã¾ã™...";

        // è¨­å®šã®å–å¾—
        const isOpenNow = document.getElementById("open-now-toggle").checked;
        const radius = parseInt(document.getElementById("radius-slider").value);
        const genre = document.getElementById("genre-select").value;

        const request = {
          location: location,
          radius: radius,
          type: "restaurant",
          keyword: genre || "é£Ÿäº‹", // ã‚¸ãƒ£ãƒ³ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã‚Œã°ãã‚Œã‚’ä½¿ç”¨
        };

        // ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã‚‹æ™‚ã ã‘ openNow ã‚’ true ã«ã™ã‚‹
        if (isOpenNow) {
          request.openNow = true;
        }

        service.nearbySearch(request, (results, status) => {
          console.log(
            "æ¤œç´¢æ¡ä»¶ - å–¶æ¥­ä¸­:",
            isOpenNow,
            "ç¯„å›²:",
            radius + "m",
            "ã‚¸ãƒ£ãƒ³ãƒ«:",
            genre || "ã™ã¹ã¦",
            "ãƒ’ãƒƒãƒˆä»¶æ•°:",
            results ? results.length : 0
          );

          if (
            status === google.maps.places.PlacesServiceStatus.OK &&
            results.length > 0
          ) {
            currentResults = results; // çµæœã‚’ä¿å­˜
            runAnimation(results);
          } else {
            // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
            let errorMsg = "è¿‘ãã«ãŠåº—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
            if (isOpenNow) {
              errorMsg +=
                "<br>ï¼ˆã€Œå–¶æ¥­ä¸­ã®ã¿ã€ã‚’å¤–ã™ã¨è¦‹ã¤ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰";
            }
            if (genre) {
              errorMsg += "<br>ï¼ˆã‚¸ãƒ£ãƒ³ãƒ«ã‚’å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ï¼‰";
            }
            handleError(errorMsg);
          }
        });
      }

      function runAnimation(results) {
        let count = 0;
        const maxCount = 30; // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãŒå›ã‚‹å›æ•°

        // ãƒ‰ãƒ©ãƒ ãƒ­ãƒ¼ãƒ«ã®ã‚ˆã†ãªæ¼”å‡º
        const interval = setInterval(() => {
          const randomPlace =
            results[Math.floor(Math.random() * results.length)];
          resultName.innerText = randomPlace.name;
          resultName.style.transform = `scale(${1 + Math.random() * 0.1})`; // æ–‡å­—ã‚’ãƒ—ãƒ«ãƒ—ãƒ«ã•ã›ã‚‹
          resultMeta.innerText = "æŠ½é¸ä¸­...";
          count++;

          if (count > maxCount) {
            clearInterval(interval);
            resultName.style.transform = "scale(1)";
            const winner = results[Math.floor(Math.random() * results.length)];
            showFinalResult(winner);
          }
        }, 80); // 0.08ç§’é–“éš”
      }

      function showFinalResult(place) {
        currentPlace = place; // ç¾åœ¨ã®ãŠåº—ã‚’ä¿å­˜

        // çµæœè¡¨ç¤º
        resultName.innerHTML = `<span style="color:#ff4757;">ğŸ‘‘ ${place.name}</span>`;

        const rating = place.rating
          ? `<span class="rating">â˜…${place.rating}</span>`
          : "";
        const price = place.price_level ? "ğŸ’°".repeat(place.price_level) : "";

        resultMeta.innerHTML = `${rating} ${price}<br>${place.vicinity}`;

        // Google Mapãƒªãƒ³ã‚¯
        const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
          place.name
        )}&query_place_id=${place.place_id}`;
        document.getElementById("map-link").href = mapUrl;

        // X (Twitter) ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯ä½œæˆ
        const shareText = `ä»Šæ—¥ã®é‹å‘½ã®ãƒ©ãƒ³ãƒã¯ã€Œ${place.name}ã€ã«æ±ºã¾ã‚Šã¾ã—ãŸï¼ğŸ½ï¸ #ä»Šæ—¥é£Ÿã¹ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ`;
        const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
          shareText
        )}&url=${encodeURIComponent(location.href)}`;
        document.getElementById("share-link").href = shareUrl;

        // ãƒœã‚¿ãƒ³é¡ã®æ›´æ–°ï¼ˆãƒªãƒ³ã‚¯è¨­å®šå¾Œã«è¡¨ç¤ºï¼‰
        startBtn.innerText = "ã‚‚ã†ä¸€åº¦ã‚„ã‚‹";
        startBtn.disabled = false;
        actionArea.style.display = "flex";

        console.log("ãƒœã‚¿ãƒ³è¡¨ç¤º:", actionArea.style.display); // ãƒ‡ãƒãƒƒã‚°ç”¨

        // å±¥æ­´ã«ä¿å­˜
        saveToHistory(place);
      }

      function handleError(msg) {
        resultName.innerHTML = "ã‚¨ãƒ©ãƒ¼";
        resultMeta.innerHTML = msg;
        startBtn.disabled = false;
        startBtn.innerText = "ã‚‚ã†ä¸€åº¦ã‚„ã‚‹";
      }
    </script>
  </body>
  <footer>
    <div class="footer-links">
      é–‹ç™ºè€…:
      <a href="https://twitter.com/ibkmakomanai" target="_blank"
        >@ibkmakomanai</a
      >
    </div>

    <div class="disclaimer">
      <p><strong>ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã€‘</strong></p>
      <p>
        å½“ã‚µã‚¤ãƒˆã¯ã€ç¾åœ¨åœ°å‘¨è¾ºã®é£²é£Ÿåº—ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã«ä½ç½®æƒ…å ±ã‚’åˆ©ç”¨ã—ã¾ã™ãŒã€å–å¾—ã—ãŸä½ç½®æƒ…å ±ã¯åˆ©ç”¨è€…ã®ç«¯æœ«å†…ã§ã®ã¿å‡¦ç†ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ç­‰ã¸ä¿å­˜ãƒ»é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“ã€‚
      </p>

      <p><strong>ã€å…è²¬äº‹é …ã€‘</strong></p>
      <p>
        æ²è¼‰ã•ã‚Œã¦ã„ã‚‹åº—èˆ—æƒ…å ±ã¯Google Maps
        APIã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚å–¶æ¥­æ™‚é–“ã‚„å®šä¼‘æ—¥ãŒå®Ÿéš›ã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã®ã§ã€æ¥åº—ã®éš›ã¯åº—èˆ—ã¸ç›´æ¥ã”ç¢ºèªãã ã•ã„ã€‚å½“ã‚µã‚¤ãƒˆã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸæå®³ã«ã¤ã„ã¦ã€é‹å–¶è€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
      </p>
    </div>

    <div style="margin-top: 10px">&copy; 2025 Food Roulette.</div>
  </footer>
</html>



